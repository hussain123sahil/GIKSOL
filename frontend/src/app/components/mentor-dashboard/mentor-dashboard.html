<div class="mentor-dashboard-shell">
	<app-mentor-sidebar class="sidebar-pane" (navigate)="router.navigate([$event])"></app-mentor-sidebar>
	<div class="mentor-dashboard-container main-pane">
		<div class="dashboard-content">
			<div class="container">
				<h1 class="page-title">Welcome back, {{ currentUser?.firstName || 'Mentor' }}!</h1>

				<!-- Loading State -->
				<div *ngIf="isLoading" class="loading-state">
					<div class="loading-spinner"></div>
					<p>Loading dashboard data...</p>
				</div>

				<!-- Error State -->
				<div *ngIf="error && !isLoading" class="error-state">
					<div class="error-icon">⚠️</div>
					<h3>Error loading dashboard</h3>
					<p>{{ error }}</p>
					<button class="btn btn-primary" (click)="loadDashboardData()">Retry</button>
				</div>

				<!-- Dashboard Content -->
				<div *ngIf="!isLoading && !error">
				<!-- Quick Stats Section -->
				<div class="quick-stats-section">
					<h2 class="section-title">Quick Stats</h2>
					<div class="quick-stats-cards">
						<div class="quick-stat-card">
							<div class="stat-icon">👥</div>
							<div class="stat-content">
								<div class="stat-title">Active Mentees</div>
								<div class="stat-value">{{ quickStats.activeMentees }}</div>
							</div>
						</div>
						<div class="quick-stat-card">
							<div class="stat-icon">📅</div>
							<div class="stat-content">
								<div class="stat-title">Upcoming Sessions</div>
								<div class="stat-value">{{ quickStats.upcomingSessions }}</div>
							</div>
						</div>
						<div class="quick-stat-card">
							<div class="stat-icon">✅</div>
							<div class="stat-content">
								<div class="stat-title">Completed Sessions</div>
								<div class="stat-value">{{ quickStats.completedSessions }}</div>
							</div>
						</div>
						<div class="quick-stat-card">
							<div class="stat-icon">❌</div>
							<div class="stat-content">
								<div class="stat-title">Cancelled Sessions</div>
								<div class="stat-value">{{ quickStats.cancelledSessions }}</div>
							</div>
						</div>
					</div>
				</div>				

				<!-- Upcoming Sessions Section -->
				<div class="upcoming-sessions-section">
					<div class="section-header">
						<h2 class="section-title">Upcoming Sessions</h2>
					</div>
					
					<div class="upcoming-sessions-grid" *ngIf="upcomingSessions.length > 0">
						<div class="session-card" *ngFor="let session of upcomingSessions">
							<div class="session-card-header">
								<div class="student-avatar">
									{{ (session.student?.firstName || 'S').charAt(0) }}
								</div>
								<div class="session-status-badge">
									<span class="status-dot upcoming"></span>
									{{ session.status | titlecase }}
								</div>
							</div>
							
							<div class="session-card-body">
								<h3 class="session-title">Session with {{ getStudentName(session) }}</h3>
								<p class="student-name">{{ getStudentName(session) }}</p>
								
								<div class="session-details">
									<div class="detail-item">
										<span class="detail-icon">📅</span>
										<span class="detail-text">{{ formatDate(session.date) }}</span>
									</div>
									<div class="detail-item">
										<span class="detail-icon">🕐</span>
										<span class="detail-text">{{ formatTime(session.time) }}</span>
									</div>
									<div class="detail-item">
										<span class="detail-icon">⏱️</span>
										<span class="detail-text">{{ session.duration }} min</span>
									</div>
									<div class="detail-item">
										<span class="detail-icon">💻</span>
										<span class="detail-text">{{ session.sessionType }}</span>
									</div>
								</div>
								
								<div class="session-notes" *ngIf="session.notes">
									<p class="notes-text">{{ session.notes }}</p>
								</div>
							</div>
							
							<div class="session-card-footer">
								<div class="start-actions">
									<button class="btn btn-primary btn-sm" (click)="startSession(session.id)" *ngIf="session.meetingLink" [disabled]="!canStartSession(session)" [class.btn-disabled]="!canStartSession(session)">
										<span class="btn-icon">🎥</span>
										Start Session
									</button>
									<div *ngIf="session.meetingLink && !canStartSession(session)" class="start-session-info">
										<span class="info-text">⏰ Available in {{ getTimeUntilStartable(session) }}</span>
									</div>
								</div>
								<div class="action-buttons">
									<button class="btn btn-danger btn-sm" (click)="cancelSession(session)" [disabled]="!canCancelSession(session)">
										<span class="btn-icon">❌</span>
										Cancel
									</button>
									<button class="btn btn-outline btn-sm" (click)="addNote(session)">
										<span class="btn-icon">📝</span>
										{{ session.notes ? 'Edit Note' : 'Add Note' }}
									</button>
								</div>
							</div>
						</div>
					</div>
					
					<div class="empty-state" *ngIf="upcomingSessions.length === 0">
						<div class="empty-icon">📅</div>
						<h3>No upcoming sessions</h3>
						<p>Your upcoming sessions will appear here.</p>
					</div>
				</div>

				<!-- Recent Sessions Section -->
				<div class="recent-sessions-section">
					<div class="section-header">
						<h2 class="section-title">Recent Sessions</h2>
					</div>
					
					<div class="recent-sessions-grid" *ngIf="completedSessions.length > 0">
						<div class="past-session-card" *ngFor="let session of completedSessions">
							<div class="past-session-header">
								<div class="past-avatar">
									{{ (session.student?.firstName || 'S').charAt(0) }}
								</div>
								<div class="session-rating" *ngIf="session.rating">
									<div class="stars">
										<span *ngFor="let star of getStars(session.rating)" class="star">{{ star }}</span>
									</div>
									<span class="rating-text">{{ session.rating }}/5</span>
								</div>
							</div>
							
							<div class="past-session-body">
								<h4 class="past-session-title">Session with {{ getStudentName(session) }}</h4>
								<p class="past-student-name">{{ getStudentName(session) }}</p>
							<div class="past-session-date">{{ formatDateTimeIST(session.date, session.time) }}</div>
							<div class="past-session-type">{{ (session.sessionType || 'Video Call').toUpperCase() }} • {{ (session.duration || 0) }} MIN</div>
						</div>
						</div>
					</div>
					
					<div class="empty-state" *ngIf="completedSessions.length === 0">
						<div class="empty-icon">📚</div>
						<h3>No completed sessions yet</h3>
						<p>Your completed sessions will appear here.</p>
					</div>
				</div>

				<!-- Active Mentees Section -->
				<div class="active-mentees-section">
					<div class="section-header">
						<h2 class="section-title">Active Mentees</h2>
					</div>
					
					<div class="mentees-grid" *ngIf="mentees.length > 0">
						<div class="mentee-card" *ngFor="let mentee of mentees">
							<div class="mentee-card-header">
								<div class="mentee-avatar">
									{{ mentee.studentName.charAt(0) }}
								</div>
								<div class="mentee-status">
									<span class="status-dot active"></span>
									Active
								</div>
							</div>
							
							<div class="mentee-card-body">
								<h3 class="mentee-name">{{ mentee.studentName }}</h3>
								<p class="mentee-school">{{ mentee.school }} • {{ mentee.grade }}</p>
								
								<div class="learning-goals">
									<span class="goal-tag" *ngFor="let goal of mentee.learningGoals">
										{{ goal }}
									</span>
								</div>
							</div>
							
							<div class="mentee-card-footer">
								<div class="mentee-stats">
									<div class="stat">
										<span class="stat-number">{{ mentee.totalSessions }}</span>
										<span class="stat-label">Sessions</span>
									</div>
									<div class="stat">
										<span class="stat-number">{{ formatDate(mentee.joinedDate) }}</span>
										<span class="stat-label">Joined</span>
									</div>
								</div>
							</div>
						</div>
					</div>
					
					<div class="empty-state" *ngIf="mentees.length === 0">
						<div class="empty-icon">👥</div>
						<h3>No active mentees</h3>
						<p>Students who connect with you will appear here.</p>
					</div>
				</div>

				<!-- Cancelled Sessions Section -->
				<div class="dashboard-section">
					<div class="section-header">
						<h2 class="section-title">Cancelled Sessions</h2>
						<div class="session-count" *ngIf="cancelledSessions.length > 0">
							{{ cancelledSessions.length }} session{{ cancelledSessions.length !== 1 ? 's' : '' }}
						</div>
					</div>
					
					<div class="sessions-grid" *ngIf="cancelledSessions.length > 0; else noCancelledSessions">
						<div class="session-card cancelled-session" *ngFor="let session of cancelledSessions">
							<!-- Session Header -->
							<div class="session-card-header">
								<div class="session-status">
									<span class="status-badge cancelled">Cancelled</span>
								</div>
								<div class="cancelled-by-tag" [ngClass]="getCancelledByClass(session)">
									{{ getCancelledByTag(session) }}
								</div>
							</div>
							
							<!-- Session Body -->
							<div class="session-card-body">
								<h3 class="session-title">Session with {{ getStudentName(session) }}</h3>
								
								<!-- Student Info for Mentors -->
								<div class="user-info">
									<p class="user-name">{{ session.student?.firstName }} {{ session.student?.lastName }}</p>
									<p class="user-email">{{ session.student?.email }}</p>
								</div>
								
								<!-- Session Details -->
								<div class="session-details">
									<div class="detail-item">
										<span class="detail-icon">📅</span>
										<span class="detail-text">{{ formatDate(session.scheduledDate || session.date) }}</span>
									</div>
									<div class="detail-item">
										<span class="detail-icon">🕐</span>
										<span class="detail-text">{{ formatTime(session.scheduledDate || session.date) }}</span>
									</div>
									<div class="detail-item">
										<span class="detail-icon">⏱️</span>
										<span class="detail-text">{{ session.duration }} min</span>
									</div>
									<div class="detail-item">
										<span class="detail-icon">💻</span>
										<span class="detail-text">{{ session.sessionType }}</span>
									</div>
								</div>
								
								<!-- Cancellation Info -->
								<div class="cancellation-info">
									<p class="cancellation-date">Cancelled on: {{ formatDate(session.cancelledAt!) }} at {{ formatTime(session.cancelledAt!) }}</p>
									<p class="cancellation-reason" *ngIf="session.cancellationReason">Reason: {{ session.cancellationReason }}</p>
								</div>
							</div>
						</div>
					</div>
					
					<ng-template #noCancelledSessions>
						<div class="empty-state">
							<div class="empty-icon">🚫</div>
							<h3>No cancelled sessions</h3>
							<p>Any sessions that are cancelled will appear here.</p>
						</div>
					</ng-template>
				</div>

				</div> <!-- End Dashboard Content -->
			</div>
		</div>
	</div>
</div>

<!-- Cancel Session Modal -->
<app-cancel-session-modal
	*ngIf="showCancelModal"
	[session]="sessionToCancel"
	[isLoading]="isCancelling"
	(confirm)="onCancelModalConfirm($event)"
	(cancel)="onCancelModalCancel()"
	(success)="onCancelModalSuccess()">
</app-cancel-session-modal>

<!-- Add Note Modal -->
<app-add-note-modal
	*ngIf="showNoteModal"
	[session]="noteModalSession"
	[isSaving]="isSavingNote"
	(save)="onNoteModalSave($event)"
	(cancel)="onNoteModalCancel()"
	(success)="onNoteModalCancel()">
</app-add-note-modal>
