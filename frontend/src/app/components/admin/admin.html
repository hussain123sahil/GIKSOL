<div class="admin-container">
  <!-- Admin Sidebar -->
  <app-admin-sidebar></app-admin-sidebar>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Header -->
    <header class="dashboard-header">
      <div class="header-content">
        <div class="header-left">
          <h1>{{ activeTab | titlecase }} Management</h1>
          <p class="header-subtitle">Manage your platform efficiently</p>
        </div>
        <div class="header-right">
          <div class="user-info">
            <span>Welcome, {{ currentUser?.firstName }} {{ currentUser?.lastName }}</span>
            <button class="btn btn-secondary" (click)="logout()">Logout</button>
          </div>
        </div>
      </div>
    </header>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <div class="spinner"></div>
      <p>Loading data...</p>
    </div>

    <!-- Dashboard Tab -->
    <div *ngIf="!isLoading && activeTab === 'dashboard'" class="dashboard-content">
      <div class="stats-grid" *ngIf="dashboardStats">
        <div class="stat-card">
          <div class="stat-icon">üë•</div>
          <div class="stat-info">
            <h3>{{ dashboardStats.totalUsers || 0 }}</h3>
            <p>Total Users</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üë®‚Äçüéì</div>
          <div class="stat-info">
            <h3>{{ dashboardStats.totalStudents || 0 }}</h3>
            <p>Students</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üë®‚Äçüè´</div>
          <div class="stat-info">
            <h3>{{ dashboardStats.totalMentors || 0 }}</h3>
            <p>Mentors</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üìÖ</div>
          <div class="stat-info">
            <h3>{{ dashboardStats.totalSessions || 0 }}</h3>
            <p>Sessions</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ü§ù</div>
          <div class="stat-info">
            <h3>{{ dashboardStats.totalConnections || 0 }}</h3>
            <p>Connections</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üìà</div>
          <div class="stat-info">
            <h3>{{ dashboardStats.recentRegistrations || 0 }}</h3>
            <p>New This Month</p>
          </div>
        </div>
      </div>

      <div class="dashboard-charts">
        <div class="chart-card">
          <h3>User Activity</h3>
          <div class="activity-stats">
            <div class="activity-item">
              <span class="activity-label">Active Users:</span>
              <span class="activity-value">{{ dashboardStats?.activeUsers || 0 }}</span>
            </div>
            <div class="activity-item">
              <span class="activity-label">Inactive Users:</span>
              <span class="activity-value">{{ dashboardStats?.inactiveUsers || 0 }}</span>
            </div>
          </div>
        </div>

        <div class="chart-card">
          <h3>Sessions by Status</h3>
          <div class="sessions-stats">
            <div class="session-item" *ngFor="let session of dashboardStats?.sessionsByStatus || []">
              <span class="session-label">{{ session._id | titlecase }}:</span>
              <span class="session-value">{{ session.count }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Users Tab -->
    <div *ngIf="!isLoading && activeTab === 'users'" class="tab-content">
      <div class="content-header">
        <div class="search-filters">
          <div class="search-box">
            <input 
              type="text" 
              [(ngModel)]="searchTerm" 
              placeholder="Search users..."
              (keyup.enter)="search()"
            >
            <button class="btn btn-primary" (click)="search()">Search</button>
          </div>
          <div class="filter-box">
            <select [(ngModel)]="selectedRole" (change)="search()">
              <option value="">All Roles</option>
              <option value="student">Students</option>
              <option value="mentor">Mentors</option>
              <option value="admin">Admins</option>
            </select>
          </div>
        </div>
        <button class="btn btn-primary" (click)="openUserModal()">
          <span>+</span> Add User
        </button>
      </div>

      <div class="data-table">
        <table>
          <thead>
            <tr>
              <th>User</th>
              <th>Email</th>
              <th>Role</th>
              <th>Status</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users">
              <td>
                <div class="user-cell">
                  <div class="user-avatar">{{ getInitials(user.firstName, user.lastName) }}</div>
                  <div class="user-details">
                    <span class="user-name">{{ user.firstName }} {{ user.lastName }}</span>
                  </div>
                </div>
              </td>
              <td>{{ user.email }}</td>
              <td>
                <span class="role-badge" [style.background-color]="getRoleColor(user.role)">
                  {{ user.role | titlecase }}
                </span>
              </td>
              <td>
                <span class="status-badge" [style.background-color]="getStatusColor(user.isActive ? 'active' : 'inactive')">
                  {{ user.isActive ? 'Active' : 'Inactive' }}
                </span>
              </td>
              <td>{{ formatDate(user.createdAt) }}</td>
              <td>
                <div class="action-buttons">
                  <button class="btn btn-sm btn-secondary" (click)="openUserModal(user)">Edit</button>
                  <button class="btn btn-sm" [class.btn-success]="!user.isActive" [class.btn-warning]="user.isActive" (click)="toggleUserStatus(user)">
                    {{ user.isActive ? 'Deactivate' : 'Activate' }}
                  </button>
                  <button class="btn btn-sm btn-danger" (click)="openDeleteModal(user)">Delete</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination" *ngIf="totalPages > 1">
        <button class="btn btn-secondary" [disabled]="currentPage === 1" (click)="onPageChange(currentPage - 1)">Previous</button>
        <span class="page-info">Page {{ currentPage }} of {{ totalPages }}</span>
        <button class="btn btn-secondary" [disabled]="currentPage === totalPages" (click)="onPageChange(currentPage + 1)">Next</button>
      </div>
    </div>

    <!-- Students Tab -->
    <div *ngIf="!isLoading && activeTab === 'students'" class="tab-content">
      <div class="content-header">
        <div class="search-filters">
          <div class="search-box">
            <input 
              type="text" 
              [(ngModel)]="searchTerm" 
              placeholder="Search students..."
              (keyup.enter)="search()"
            >
            <button class="btn btn-primary" (click)="search()">Search</button>
          </div>
        </div>
      </div>

      <div class="data-table">
        <table>
          <thead>
            <tr>
              <th>Student</th>
              <th>Email</th>
              <th>Level</th>
              <th>Goals</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let student of students">
              <td>
                <div class="user-cell">
                  <div class="user-avatar">{{ getInitials(student.firstName, student.lastName) }}</div>
                  <div class="user-details">
                    <span class="user-name">{{ student.firstName }} {{ student.lastName }}</span>
                  </div>
                </div>
              </td>
              <td>{{ student.email }}</td>
              <td>{{ student.profile.currentLevel | titlecase }}</td>
              <td>
                <div class="goals-tags">
                  <span class="goal-tag" *ngFor="let goal of student.profile.learningGoals.slice(0, 2)">
                    {{ goal }}
                  </span>
                </div>
              </td>
              <td>
                <span class="status-badge" [style.background-color]="getStatusColor(student.isActive ? 'active' : 'inactive')">
                  {{ student.isActive ? 'Active' : 'Inactive' }}
                </span>
              </td>
              <td>
                <div class="action-buttons">
                  <button class="btn btn-sm btn-secondary" (click)="openUserModal(student)">Edit</button>
                  <button class="btn btn-sm" [class.btn-success]="!student.isActive" [class.btn-warning]="student.isActive" (click)="toggleUserStatus(student)">
                    {{ student.isActive ? 'Deactivate' : 'Activate' }}
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination" *ngIf="totalPages > 1">
        <button class="btn btn-secondary" [disabled]="currentPage === 1" (click)="onPageChange(currentPage - 1)">Previous</button>
        <span class="page-info">Page {{ currentPage }} of {{ totalPages }}</span>
        <button class="btn btn-secondary" [disabled]="currentPage === totalPages" (click)="onPageChange(currentPage + 1)">Next</button>
      </div>
    </div>

    <!-- Mentors Tab -->
    <div *ngIf="!isLoading && activeTab === 'mentors'" class="tab-content">
      <div class="content-header">
        <div class="search-filters">
          <div class="search-box">
            <input 
              type="text" 
              [(ngModel)]="searchTerm" 
              placeholder="Search mentors..."
              (keyup.enter)="search()"
            >
            <button class="btn btn-primary" (click)="search()">Search</button>
          </div>
        </div>
      </div>

      <div class="data-table">
        <table>
          <thead>
            <tr>
              <th>Mentor</th>
              <th>Email</th>
              <th>Company</th>
              <th>Rate</th>
              <th>Rating</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let mentor of mentors">
              <td>
                <div class="user-cell">
                  <div class="user-avatar">{{ getInitials(mentor.firstName, mentor.lastName) }}</div>
                  <div class="user-details">
                    <span class="user-name">{{ mentor.firstName }} {{ mentor.lastName }}</span>
                  </div>
                </div>
              </td>
              <td>{{ mentor.email }}</td>
              <td>{{ mentor.profile.company }}</td>
              <td>${{ mentor.profile.hourlyRate }}/hr</td>
              <td>
                <div class="rating">
                  <span class="stars">‚≠ê</span>
                  <span>{{ mentor.profile.rating.toFixed(1) }}</span>
                </div>
              </td>
              <td>
                <span class="status-badge" [style.background-color]="getStatusColor(mentor.isActive ? 'active' : 'inactive')">
                  {{ mentor.isActive ? 'Active' : 'Inactive' }}
                </span>
              </td>
              <td>
                <div class="action-buttons">
                  <button class="btn btn-sm btn-secondary" (click)="openUserModal(mentor)">Edit</button>
                  <button class="btn btn-sm" [class.btn-success]="!mentor.isActive" [class.btn-warning]="mentor.isActive" (click)="toggleUserStatus(mentor)">
                    {{ mentor.isActive ? 'Deactivate' : 'Activate' }}
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination" *ngIf="totalPages > 1">
        <button class="btn btn-secondary" [disabled]="currentPage === 1" (click)="onPageChange(currentPage - 1)">Previous</button>
        <span class="page-info">Page {{ currentPage }} of {{ totalPages }}</span>
        <button class="btn btn-secondary" [disabled]="currentPage === totalPages" (click)="onPageChange(currentPage + 1)">Next</button>
      </div>
    </div>

    <!-- Sessions Tab -->
    <div *ngIf="!isLoading && activeTab === 'sessions'" class="tab-content">
      <div class="content-header">
        <div class="search-filters">
          <div class="search-box">
            <input 
              type="text" 
              [(ngModel)]="searchTerm" 
              placeholder="Search sessions..."
              (keyup.enter)="search()"
            >
            <button class="btn btn-primary" (click)="search()">Search</button>
          </div>
          <div class="filter-box">
            <select [(ngModel)]="selectedStatus" (change)="search()">
              <option value="">All Status</option>
              <option value="scheduled">Scheduled</option>
              <option value="completed">Completed</option>
              <option value="cancelled">Cancelled</option>
            </select>
          </div>
        </div>
      </div>

      <div class="data-table">
        <table>
          <thead>
            <tr>
              <th>Session</th>
              <th>Student</th>
              <th>Mentor</th>
              <th>Date</th>
              <th>Duration</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let session of sessions">
              <td>
                <div class="session-info">
                  <h4>{{ session.title }}</h4>
                  <p>{{ session.description }}</p>
                </div>
              </td>
              <td>{{ session.student.firstName }} {{ session.student.lastName }}</td>
              <td>{{ session.mentor.firstName }} {{ session.mentor.lastName }}</td>
              <td>{{ formatDate(session.scheduledDate) }}</td>
              <td>{{ session.duration }} min</td>
              <td>
                <span class="status-badge" [style.background-color]="getStatusColor(session.status)">
                  {{ session.status | titlecase }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination" *ngIf="totalPages > 1">
        <button class="btn btn-secondary" [disabled]="currentPage === 1" (click)="onPageChange(currentPage - 1)">Previous</button>
        <span class="page-info">Page {{ currentPage }} of {{ totalPages }}</span>
        <button class="btn btn-secondary" [disabled]="currentPage === totalPages" (click)="onPageChange(currentPage + 1)">Next</button>
      </div>
    </div>

    <!-- Connections Tab -->
    <div *ngIf="!isLoading && activeTab === 'connections'" class="tab-content">
      <div class="content-header">
        <div class="search-filters">
          <div class="search-box">
            <input 
              type="text" 
              [(ngModel)]="searchTerm" 
              placeholder="Search connections..."
              (keyup.enter)="search()"
            >
            <button class="btn btn-primary" (click)="search()">Search</button>
          </div>
          <div class="filter-box">
            <select [(ngModel)]="selectedStatus" (change)="search()">
              <option value="">All Status</option>
              <option value="pending">Pending</option>
              <option value="accepted">Accepted</option>
              <option value="rejected">Rejected</option>
            </select>
          </div>
        </div>
      </div>

      <div class="data-table">
        <table>
          <thead>
            <tr>
              <th>Student</th>
              <th>Mentor</th>
              <th>Message</th>
              <th>Requested</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let connection of connections">
              <td>{{ connection.student.firstName }} {{ connection.student.lastName }}</td>
              <td>{{ connection.mentor.firstName }} {{ connection.mentor.lastName }}</td>
              <td class="message-cell">{{ connection.message }}</td>
              <td>{{ formatDate(connection.requestedAt) }}</td>
              <td>
                <span class="status-badge" [style.background-color]="getStatusColor(connection.status)">
                  {{ connection.status | titlecase }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination" *ngIf="totalPages > 1">
        <button class="btn btn-secondary" [disabled]="currentPage === 1" (click)="onPageChange(currentPage - 1)">Previous</button>
        <span class="page-info">Page {{ currentPage }} of {{ totalPages }}</span>
        <button class="btn btn-secondary" [disabled]="currentPage === totalPages" (click)="onPageChange(currentPage + 1)">Next</button>
      </div>
    </div>
  </div>
</div>

<!-- User Modal -->
<div class="modal-overlay" *ngIf="showUserModal" (click)="closeUserModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ isEditing ? 'Edit User' : 'Add New User' }}</h3>
      <button class="close-btn" (click)="closeUserModal()">&times;</button>
    </div>
    <div class="modal-body">
      <form (ngSubmit)="saveUser()">
        <div class="form-group">
          <label>First Name *</label>
          <input type="text" [(ngModel)]="userForm.firstName" name="firstName" required>
        </div>
        <div class="form-group">
          <label>Last Name *</label>
          <input type="text" [(ngModel)]="userForm.lastName" name="lastName" required>
        </div>
        <div class="form-group">
          <label>Email *</label>
          <input type="email" [(ngModel)]="userForm.email" name="email" required>
        </div>
        <div class="form-group">
          <label>Password {{ isEditing ? '(leave blank to keep current)' : '*' }}</label>
          <input type="password" [(ngModel)]="userForm.password" name="password" [required]="!isEditing">
        </div>
        <div class="form-group">
          <label>Role</label>
          <select [(ngModel)]="userForm.role" name="role">
            <option value="student">Student</option>
            <option value="mentor">Mentor</option>
            <option value="admin">Admin</option>
          </select>
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="userForm.isActive" name="isActive">
            Active User
          </label>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeUserModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Confirm Delete</h3>
      <button class="close-btn" (click)="closeDeleteModal()">&times;</button>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to delete <strong>{{ selectedUser?.firstName }} {{ selectedUser?.lastName }}</strong>?</p>
      <p class="warning-text">This action cannot be undone and will delete all associated data.</p>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeDeleteModal()">Cancel</button>
        <button type="button" class="btn btn-danger" (click)="deleteUser()">Delete</button>
      </div>
    </div>
  </div>
</div>